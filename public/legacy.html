<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title>Wall Display</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, Helvetica, Arial, sans-serif;
      background: #000;
      color: #fff;
      min-height: 100vh;
      padding: 40px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    .time {
      font-size: 120px;
      font-weight: 200;
      text-align: center;
      letter-spacing: -5px;
      margin-bottom: 10px;
    }
    .date {
      font-size: 24px;
      text-align: center;
      color: #888;
      margin-bottom: 60px;
    }
    .weather {
      text-align: center;
      margin-bottom: 60px;
    }
    .weather-temp {
      font-size: 80px;
      font-weight: 200;
    }
    .weather-desc {
      font-size: 20px;
      color: #888;
      margin-top: 10px;
    }
    .message {
      text-align: center;
      padding: 40px;
      background: #111;
      border-radius: 20px;
      margin-bottom: 40px;
    }
    .message-title {
      font-size: 48px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .message-sub {
      font-size: 18px;
      color: #888;
      line-height: 1.6;
    }
    .projects {
      background: #111;
      border-radius: 20px;
      padding: 30px;
    }
    .projects-title {
      font-size: 14px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 20px;
    }
    .project {
      padding: 15px 0;
      border-bottom: 1px solid #222;
      font-size: 18px;
    }
    .project:last-child {
      border-bottom: none;
    }
    .project-priority {
      color: #e74c3c;
    }
    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 12px;
      color: #444;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="time" id="time">--:--</div>
    <div class="date" id="date">Loading...</div>

    <div class="weather" id="weather">
      <div class="weather-temp" id="weather-temp">--</div>
      <div class="weather-desc" id="weather-desc">Loading weather...</div>
    </div>

    <div class="message">
      <div class="message-title">Fast.</div>
      <div class="message-sub">
        Decisions made quickly. Projects completed efficiently.<br>
        No overthinking. No delays. Just action.
      </div>
    </div>

    <div class="projects">
      <div class="projects-title">Priority Projects</div>
      <div id="projects-list">
        <div class="loading">Loading projects...</div>
      </div>
    </div>

    <div class="footer">
      Auto-refreshes every 5 minutes
    </div>
  </div>

  <script>
    // Update time
    function updateTime() {
      var now = new Date();
      var hours = now.getHours();
      var minutes = now.getMinutes();
      var ampm = hours >= 12 ? 'PM' : 'AM';
      hours = hours % 12;
      hours = hours ? hours : 12;
      minutes = minutes < 10 ? '0' + minutes : minutes;

      document.getElementById('time').innerHTML = hours + ':' + minutes + ' <small style="font-size:40px;color:#666">' + ampm + '</small>';

      var days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
      var months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
      document.getElementById('date').innerHTML = days[now.getDay()] + ', ' + months[now.getMonth()] + ' ' + now.getDate();
    }

    // Fetch weather
    function fetchWeather() {
      var lat = -37.8136;
      var lon = 144.9631;
      var url = 'https://api.open-meteo.com/v1/forecast?latitude=' + lat + '&longitude=' + lon + '&current_weather=true';

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4 && xhr.status === 200) {
          try {
            var data = JSON.parse(xhr.responseText);
            var temp = Math.round(data.current_weather.temperature);
            document.getElementById('weather-temp').innerHTML = temp + '&deg;C';

            var code = data.current_weather.weathercode;
            var desc = 'Clear';
            if (code >= 1 && code <= 3) desc = 'Partly Cloudy';
            if (code >= 45 && code <= 48) desc = 'Foggy';
            if (code >= 51 && code <= 67) desc = 'Rainy';
            if (code >= 71 && code <= 77) desc = 'Snowy';
            if (code >= 80 && code <= 82) desc = 'Showers';
            if (code >= 95) desc = 'Thunderstorm';

            document.getElementById('weather-desc').innerHTML = desc + ' in Melbourne';
          } catch (e) {
            document.getElementById('weather-desc').innerHTML = 'Weather unavailable';
          }
        }
      };
      xhr.send();
    }

    // Fetch projects from Supabase
    function fetchProjects() {
      var url = 'https://gyydvawtndydqjifsubp.supabase.co/rest/v1/projects?status=neq.completed&order=position.asc&limit=5';
      var key = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd5eWR2YXd0bmR5ZHFqaWZzdWJwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQ4NTM5NzUsImV4cCI6MjA1MDQyOTk3NX0.aeuK0kHXr0lEfz1muhBG1ATr1V40aGQlMVRhd2gfsXo';

      var xhr = new XMLHttpRequest();
      xhr.open('GET', url, true);
      xhr.setRequestHeader('apikey', key);
      xhr.setRequestHeader('Authorization', 'Bearer ' + key);
      xhr.onreadystatechange = function() {
        if (xhr.readyState === 4) {
          var list = document.getElementById('projects-list');
          if (xhr.status === 200) {
            try {
              var projects = JSON.parse(xhr.responseText);
              if (projects.length === 0) {
                list.innerHTML = '<div class="project">No active projects</div>';
                return;
              }
              var html = '';
              for (var i = 0; i < projects.length; i++) {
                var p = projects[i];
                var cls = p.caroline_priority ? 'project project-priority' : 'project';
                var prefix = p.caroline_priority ? '! ' : '';
                html += '<div class="' + cls + '">' + prefix + p.title + '</div>';
              }
              list.innerHTML = html;
            } catch (e) {
              list.innerHTML = '<div class="project">Could not load projects</div>';
            }
          } else {
            list.innerHTML = '<div class="project">Projects unavailable</div>';
          }
        }
      };
      xhr.send();
    }

    // Initialize
    updateTime();
    fetchWeather();
    fetchProjects();

    // Update time every second
    setInterval(updateTime, 1000);

    // Refresh data every 5 minutes
    setInterval(function() {
      fetchWeather();
      fetchProjects();
    }, 300000);

    // Full page refresh every 30 minutes to clear memory
    setTimeout(function() {
      location.reload();
    }, 1800000);
  </script>
</body>
</html>
